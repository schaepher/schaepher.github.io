<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>RESTful 程度 - Schaepher's Blog</title><meta name=Description content="深透理解，熟练运用；似懂非懂，其实不懂。"><meta property="og:title" content="RESTful 程度"><meta property="og:description" content="REST = REpresentational State Transfer 逐步接近 REST Martin Fowler 在博客《steps toward the glory of REST》中提到 https://martinfowler.com/articles/richardsonMaturityModel.html 简单的说： level 0 ： 没有资源的概念。url 上面最后一个部分经常是个动词。例如"><meta property="og:type" content="article"><meta property="og:url" content="https://schaepher.github.io/2018/10/08/restful/"><meta property="og:image" content="https://schaepher.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-10-08T00:19:00+00:00"><meta property="article:modified_time" content="2018-10-08T00:19:00+00:00"><meta property="og:site_name" content="Schaepher's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://schaepher.github.io/logo.png"><meta name=twitter:title content="RESTful 程度"><meta name=twitter:description content="REST = REpresentational State Transfer 逐步接近 REST Martin Fowler 在博客《steps toward the glory of REST》中提到 https://martinfowler.com/articles/richardsonMaturityModel.html 简单的说： level 0 ： 没有资源的概念。url 上面最后一个部分经常是个动词。例如"><meta name=application-name content="Schaepher's Blog"><meta name=apple-mobile-web-app-title content="Schaepher's Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://schaepher.github.io/2018/10/08/restful/><link rel=prev href=https://schaepher.github.io/2018/10/08/stackstorm_0/><link rel=next href=https://schaepher.github.io/2018/10/08/restful-http-code/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=/lib/fontawesome-free/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload href=/lib/animate/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"RESTful 程度","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/schaepher.github.io\/2018\/10\/08\/restful\/"},"genre":"posts","keywords":"RESTful","wordcount":1640,"url":"https:\/\/schaepher.github.io\/2018\/10\/08\/restful\/","datePublished":"2018-10-08T00:19:00+00:00","dateModified":"2018-10-08T00:19:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Schaepher"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Schaepher's Blog"></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/>主页 </a><a class=menu-item href=/posts/ title=文章按年份分类>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Schaepher's Blog"></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/ title>主页</a><a class=menu-item href=/posts/ title=文章按年份分类>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">RESTful 程度</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://cnblogs.com/schaepher title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Schaepher</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/restful/><i class="far fa-folder fa-fw" aria-hidden=true></i>RESTful</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2018-10-08>2018-10-08</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 1640 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 4 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept=true><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#逐步接近-rest>逐步接近 REST</a></li><li><a href=#put-和-post-的区别>PUT 和 POST 的区别</a></li><li><a href=#无状态>无状态</a></li><li><a href=#url-形式>url 形式</a></li><li><a href=#id>ID</a></li><li><a href=#资源间的关系>资源间的关系</a></li><li><a href=#名词-url>名词 URL</a></li></ul></nav></div></div><div class=content id=content><p>REST = REpresentational State Transfer</p><h2 id=逐步接近-rest>逐步接近 REST</h2><p>Martin Fowler 在博客《steps toward the glory of REST》中提到</p><blockquote><p><a href=https://martinfowler.com/articles/richardsonMaturityModel.html target=_blank rel="noopener noreffer">https://martinfowler.com/articles/richardsonMaturityModel.html</a></p></blockquote><p>简单的说：</p><ul><li><p>level 0 ：<br>没有资源的概念。url 上面最后一个部分经常是个动词。例如：<code>POST /appointmentService</code> 。</p><p>甚至只有一个</p><p>HTTP 头部不涉及业务逻辑，相当于降级为传输层协议。</p></li><li><p>level 1 ：<br>有了资源的概念，在 url 上面使用名词。但只用到了两个 web 操作：GET、POST。</p><p>当发生错误时，仍然返回 <code>200 OK</code> 并附上错误信息。例如某个资源已被其他人创建（医生的预约名额），这是一个不相容（incompatible）的资源，你无法再创建。</p></li><li><p>level 2：<br>除了 POST 之外，还使用更多的操作：DELETE、PUT、HEAD、OPTIONS、PATCH</p><p>出现错误时，不再使用 <code>200 OK</code>。例如上面的错误会返回 <code>409 Conflict</code> ，不用带上错误信息调用方也能知道是什么错误。</p><p>当资源创建成功时，不再返回 <code>200 OK</code>，而是返回 <code>201 CREATED</code> 。<br>这样就让 HTTP code 有更多的表达空间。</p></li><li><p>level 3：<br>返回的结果不仅包含了所请求的信息，还包含了该资源其他操作的链接。</p><blockquote><p><a href=http://olivergierke.de/2016/04/benefits-of-hypermedia/ target=_blank rel="noopener noreffer">http://olivergierke.de/2016/04/benefits-of-hypermedia/</a></p></blockquote><p>客户端在请求的时候，从这些链接中取出想要的链接，并执行操作。客户端不应将这样的链接硬编码到代码里面，否则将来接口变动会很麻烦。</p><p>如果没有这些信息，它不能叫做 REST API，只能称之为 REST-like API。</p><blockquote><p><a href=https://github.com/NationalBankBelgium/REST-API-Design-Guide/issues/8 target=_blank rel="noopener noreffer">https://github.com/NationalBankBelgium/REST-API-Design-Guide/issues/8</a></p></blockquote><p>不能把所有操作的链接都暴露出来，而是根据用户的访问权限暴露出他所能访问的所有连接。</p><blockquote><p><a href=https://github.com/NationalBankBelgium/REST-API-Design-Guide/issues/9 target=_blank rel="noopener noreffer">https://github.com/NationalBankBelgium/REST-API-Design-Guide/issues/9</a></p></blockquote></li></ul><h2 id=put-和-post-的区别>PUT 和 POST 的区别</h2><p><a href=https://stackoverflow.com/a/630475 target=_blank rel="noopener noreffer">https://stackoverflow.com/a/630475</a></p><p>两者都可以用来创建资源，但是场景不同。</p><ul><li>POST 让服务端决定资源的名称 <code>POST /questions</code><br>服务器返回这样的链接： <code>/questions/&lt;question_id></code></li><li>PUT 由客户端决定资源的名称 <code>PUT /questions/&lt;new_question></code><br>服务器返回这样的链接： <code>/questions/&lt;new_question></code>
PUT 是幂等的。这意味着执行多次 PUT 的结果都一致。但是如果用 POST，就会产生很多个资源。<br>例如：x=5 是幂等的，这个赋值运算执行一百次， x 都是等于 5。但 x++ 不是幂等的。<br><a href=https://stackoverflow.com/a/2691891 target=_blank rel="noopener noreffer">https://stackoverflow.com/a/2691891</a><br>除了 PUT ， GET 和 DELETE 也是幂等的。<br>PUT 可以用于替换已有的资源。而如果是部分更新，则使用 PATCH。</li></ul><p>用 POST 还是用 PUT，主要还是看是否要求幂等。</p><p>其他的可以去看 RFC 7231。</p><blockquote><p><a href=http://www.rfcreader.com/#rfc7231 target=_blank rel="noopener noreffer">http://www.rfcreader.com/#rfc7231</a></p></blockquote><blockquote><p>2014 年 RFC 7230 - 7235 将原来的 RFC 2616 拆成六个单独的协议说明。<br><a href=https://www.infoq.cn/article/2014%2F06%2Fhttp-11-updated target=_blank rel="noopener noreffer">https://www.infoq.cn/article/2014%2F06%2Fhttp-11-updated</a><br><a href=http://www.rfcreader.com/#rfc7230 target=_blank rel="noopener noreffer">http://www.rfcreader.com/#rfc7230</a></p></blockquote><blockquote><p>The fundamental difference between the POST and PUT methods is highlighted by the different intent for the enclosed representation. The target resource in a POST request is intended to handle the enclosed representation according to the resource&rsquo;s own semantics, whereas the enclosed representation in a PUT request is defined as replacing the state of the target resource. Hence, the intent of PUT is idempotent and visible to intermediaries, even though the exact effect is only known by the origin server.<br>POST 和 PUT 之间的根本区别突出在封装表征（enclosed representation，即请求体）具有不一样的目的。 POST 请求中的目标资源根据资源自身的语义处理封装表征，而 PUT 请求中的封装表征则是用于替代目标资源的状态。因此， PUT 的目的是幂等和对中介可见，即使确切的影响只有服务端知道。</p></blockquote><h2 id=无状态>无状态</h2><p>RESTful API 必须是无状态的。这意味着服务器不保存客户端的会话信息，而是由客户端来保存。</p><p>例如：JWT（JSON Web Token）</p><blockquote><p><a href=https://en.wikipedia.org/wiki/JSON_Web_Token target=_blank rel="noopener noreffer">https://en.wikipedia.org/wiki/JSON_Web_Token</a></p></blockquote><p>服务端有一串密钥，将用户的登录信息加密，生成密文，并发给客户端。客户端在请求的时候，将密文放到 HTTP Header。服务端用密钥解密客户端发来的密文。如果无法解密，则说明这个密文不是由服务端的密钥加密的，是伪造的；如果能够解密，则表示该密文是由服务端的密钥加密的。</p><p>如果服务端有多台机器，那么每台机器只要用相同的密钥加密，其他机器就能解密。这样就能愉快地使用负载均衡了。</p><h2 id=url-形式>url 形式</h2><p>如果一个资源的名称由超过一个单词组成，那么单词间用减号（-)连接。例如：<code>/contract-types</code>。</p><p>资源总是用复数命名，并且每个资源都有一个 ID</p><p>当 url 带 ID 时，获取的是单个资源；不带 ID 时，获取所有资源（或者说想要获取）。</p><h2 id=id>ID</h2><p>在URL上使用 UUID ，但数据库里面的主键还是要用自增 ID。</p><blockquote><p><a href=https://www.zhihu.com/question/43500172/answer/95903244 target=_blank rel="noopener noreffer">https://www.zhihu.com/question/43500172/answer/95903244</a></p></blockquote><p>理由是：</p><ul><li>MySQL 的 InnoDB 对主键采用聚集索引。如果使用 UUID 作为主键，索引插入的位置是乱序的，会导致索引树节点的频繁分裂。同时由于相邻主键的数据存放在磁盘同一个或者相邻的页中，也会导致页的分裂，影响 IO。</li><li>InnoDB 的非主键索引叶子节点存储的是主键值。 UUID 比自增 ID 所占的存储空间大，使用存储占用大的主键会导致非主键索引的总体空间变大。</li></ul><h2 id=资源间的关系>资源间的关系</h2><p>如果资源 A 必须依赖于资源 B，那么应该设计成这样：</p><p>GET /tickets/12/messages</p><p>表明 messages 必须依赖于 tickets</p><h2 id=名词-url>名词 URL</h2><p>搜索：Search</p><p>执行：Execution</p><p>批量执行： Bulk</p><p>批量的另一种：例如创建一个删除的资源 POST /xxx/delete-requests</p><blockquote><p>Delete multiple records using REST<br><a href=https://stackoverflow.com/questions/21863326/delete-multiple-records-using-rest target=_blank rel="noopener noreffer">https://stackoverflow.com/questions/21863326/delete-multiple-records-using-rest</a></p></blockquote></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2018-10-08</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/2018/10/08/restful/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://schaepher.github.io/2018/10/08/restful/ data-title="RESTful 程度" data-hashtags=RESTful><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://schaepher.github.io/2018/10/08/restful/ data-hashtag=RESTful><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://schaepher.github.io/2018/10/08/restful/ data-title="RESTful 程度"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://schaepher.github.io/2018/10/08/restful/ data-title="RESTful 程度"><i data-svg-src=/lib/simple-icons/icons/line.min.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://schaepher.github.io/2018/10/08/restful/ data-title="RESTful 程度"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Evernote" data-sharer=evernote data-url=https://schaepher.github.io/2018/10/08/restful/ data-title="RESTful 程度"><i class="fab fa-evernote fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/restful/>RESTful</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/2018/10/08/stackstorm_0/ class=prev rel=prev title=Stackstorm><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Stackstorm</a>
<a href=/2018/10/08/restful-http-code/ class=next rel=next title="RESTful API HTTP Code">RESTful API HTTP Code<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.101.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2017 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://cnblogs.com/schaepher target=_blank>Schaepher</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/katex/katex.min.css><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/contrib/auto-render.min.js></script><script type=text/javascript src=/lib/katex/contrib/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/contrib/mhchem.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>