<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"schaepher.github.io","root":"/","scheme":"Gemini","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gittalk","storage":true,"lazyload":false,"nav":{"gitalk":"Load Gitalk"}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="深透理解，熟练运用。似懂非懂，其实不懂。">
<meta property="og:type" content="website">
<meta property="og:title" content="Schaepher&#39;s Blog">
<meta property="og:url" content="https://schaepher.github.io/index.html">
<meta property="og:site_name" content="Schaepher&#39;s Blog">
<meta property="og:description" content="深透理解，熟练运用。似懂非懂，其实不懂。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Schaepher">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://schaepher.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false
  };
</script>

  <title>Schaepher's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Schaepher's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="search-pop-overlay">
  <div class="popup search-popup">
      <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

  </div>
</div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/schaepher" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://schaepher.github.io/2022/07/22/2022-life-part2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/theme/avatar.png">
      <meta itemprop="name" content="Schaepher">
      <meta itemprop="description" content="深透理解，熟练运用。<br>似懂非懂，其实不懂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schaepher's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/07/22/2022-life-part2/" class="post-title-link" itemprop="url">磨刀不误砍柴工 —— 2022.05~07</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-07-22 15:41:00" itemprop="dateCreated datePublished" datetime="2022-07-22T15:41:00+00:00">2022-07-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在上一篇文章中，我记录了两个身体上没有解决的问题。其中眼睛的问题在 6 月 19 日已经恢复了，胃胀也在眼睛恢复的这段时间消失了。除此之外，个人状态在 7 月也有一定的恢复，下文详说。</p>
<p>这段时间的主基调是离职和找工作。</p>
<h2 id="离职"><a href="#离职" class="headerlink" title="离职"></a>离职</h2><p>2022 年深圳互联网公司裁人很多。我所在的产品线亏损不小，公司就决定把整个产品线撤掉。领导问我想不想留着，我觉得留着能创造的价值有限，就说还是离开吧。</p>
<p>虽然各个大公司裁了大量人员导致找工作比以往更加困难，但是我觉得没有担心的必要。最终能去哪家公司，并不是有能力就行，还得看缘分。就像我两年前换工作地点的时候也是错过了最佳的换工作时间，但是仍然在偶然的机会下面到了这家公司，岗位和我的需要完全匹配。</p>
<p>说是离职，但也不是主动提的，毕竟主动提就没有 N+1 了。拿这个 N+1 有很大的好处。为我接下来一段时间的规划提供了物质保障，会更有底气一些。</p>
<h2 id="规划"><a href="#规划" class="headerlink" title="规划"></a>规划</h2><p>我的规划大致分为三件事情：</p>
<ol>
<li>写一写今年的事情，也就是 5 月 19 日发布的那篇。此外把我对人生观的思考写出来。</li>
<li>把我觉得对我未来职业发展的两块重要内容补上来</li>
<li>做好面试的准备</li>
</ol>
<h3 id="输出思考内容"><a href="#输出思考内容" class="headerlink" title="输出思考内容"></a>输出思考内容</h3><p>人生观的内容写了四千字，还没有完成。人生观的内容比其他两部分更难组织各个部分的逻辑关系。原先没有写下来的时候，脑子里会经常去思考相关内容，结果写了一部分之后，就比较少去思考了。我想大概需要等待一种感觉，而且还有其他规划要执行，就在 5 月 25 日停了下来。</p>
<h3 id="补充知识"><a href="#补充知识" class="headerlink" title="补充知识"></a>补充知识</h3><p>我一直有再次全身心投入学习重要知识点的想法。我现在还想着，如果有机会，一定要去读研。除了感受学习本身的快乐，还可以让自己的基础更牢固，有利于后续发展。</p>
<p>我给了自己一段时间，去学习对于找工作没有多大用处但对于长期有用处的专业相关知识。</p>
<p>读者大概也有这样的感受：现在再去学习以前学校里教的知识，不仅很容易理解，而且理解得更加深刻。</p>
<p>我重视自己的未来，所以对于能够让我走得更远的思想和知识更加重视。所以长期以来，有两块内容让我觉得无论如何都应该解决。以前没有理解的内容，现在要理解。以前理解的内容，要偶尔回顾，加深理解。</p>
<p>我给了自己一个月的时间去图书馆学习，包括把学习的内容写下来。附带的好处是养成了去图书馆的习惯，找到工作后周末可以到图书馆学习。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://schaepher.github.io/2022/06/29/wechat-message/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/theme/avatar.png">
      <meta itemprop="name" content="Schaepher">
      <meta itemprop="description" content="深透理解，熟练运用。<br>似懂非懂，其实不懂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schaepher's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/29/wechat-message/" class="post-title-link" itemprop="url">在个人微信上与自搭服务端交互</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-06-29 16:37:00" itemprop="dateCreated datePublished" datetime="2022-06-29T16:37:00+00:00">2022-06-29</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>我有时候想捣鼓个工具用。起初是为了让我及时掌握一些信息，想做一个消息推送功能。但是由于功能简单，不想单独开发个手机 APP。于是就想着能否直接把消息推送到个人微信上。</p>
<h1 id="面临的问题"><a href="#面临的问题" class="headerlink" title="面临的问题"></a>面临的问题</h1><p>以前有 web 版的个人微信，有些人就基于 web 版的个人微信接口做了一个开发套件。但是现在 web 版只有少数一些微信号能够登录，我就登录不了。</p>
<p>另一种方式是申请公众号，使用公众号的消息推送。但是公众号主要是对关注者的，只用来给我自己推送消息不太合适。而如果在公众号上增加一些其他功能，等于是把功能开放给所有关注的人了，没什么必要。</p>
<blockquote>
<p>后来我才知道公众号的消息推送有次数限制，不过对于个人使用已经足够了。</p>
</blockquote>
<p>最终采取的方案是通过企业微信把消息推送到个人微信。</p>
<h1 id="实现后的消息流向"><a href="#实现后的消息流向" class="headerlink" title="实现后的消息流向"></a>实现后的消息流向</h1><p>个人微信 -&gt; 企业微信 -&gt; 个人服务器<br>个人微信 &lt;- 企业微信 &lt;- 个人服务器</p>
<h1 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h1><ol>
<li>在企业微信手机端上创建企业（不会核实真实企业）</li>
<li>在企业微信web端管理页面通过个人微信扫码绑定企业的微信插件</li>
<li>在web端管理页面上创建应用</li>
<li>在个人服务器上启动服务</li>
<li>web端管理页面设置应用接收信息的 API 地址</li>
<li>在个人微信上收发消息</li>
</ol>
<h2 id="1-在企业微信上创建企业"><a href="#1-在企业微信上创建企业" class="headerlink" title="1. 在企业微信上创建企业"></a>1. 在企业微信上创建企业</h2><p>以手机企业微信为例，菜单依次如下：</p>
<p>我 | 设置 | 管理企业 | 全新创建企业 | 企业</p>
<ul>
<li>填写企业名称</li>
<li>行业类型根据需要选择</li>
<li>员工规模选择1-50人</li>
<li>真实姓名填写自己的姓名</li>
</ul>
<p>点击创建就能创建成功了。</p>
<h2 id="2-绑定插件"><a href="#2-绑定插件" class="headerlink" title="2. 绑定插件"></a>2. 绑定插件</h2><p>上一步创建企业后，会自动将当前帐号切换到这个企业（之后可以来回切换）。</p>
<p>电脑浏览器访问：</p>
<p><a href="https://work.weixin.qq.com/wework_admin/frame#profile/wxPlugin" target="_blank" rel="noopener">https://work.weixin.qq.com/wework_admin/frame#profile/wxPlugin</a></p>
<p>在切换到新创建的企业后，用企业微信的扫码登录。</p>
<p>登录后会自动跳转到【微信插件】功能页。可以看到下图那样的页面。</p>
<p><img src="./plugin-qrcode.jpg" alt=""></p>
<p>用个人微信扫【邀请关注】一栏的二维码。关注后，个人微信会绑定该企业。如果企业微信加入了多个企业（如正在任职的企业），不用担心会绑定到这些企业上。</p>
<h2 id="3-创建应用"><a href="#3-创建应用" class="headerlink" title="3. 创建应用"></a>3. 创建应用</h2><p>电脑浏览器访问：</p>
<p><a href="https://work.weixin.qq.com/wework_admin/frame#apps" target="_blank" rel="noopener">https://work.weixin.qq.com/wework_admin/frame#apps</a></p>
<p>进入应用管理模块。</p>
<p>依次访问：</p>
<p>应用 | 自建 | 创建应用</p>
<p>如下图：</p>
<p><img src="./app-management.jpg" alt=""></p>
<p>填写页面要求的信息，记得在可见范围里把自己选上。</p>
<p><img src="./create-app.jpg" alt=""></p>
<p>创建成功后，进入应用页面可以看到以下信息：</p>
<ul>
<li>AgentId</li>
<li>Secret</li>
<li>功能 | 接收消息 | 设置API接收</li>
</ul>
<p><img src="./app-main.jpg" alt=""></p>
<p>其中标记 2 的 Secret 是企业的密码。在请求企业微信接口的时候，要使用企业 ID 和应用密码获取 Token。</p>
<p>接着进入应用页面里标记 3 的【设置API接收】。</p>
<p><img src="./api-rec.jpg" alt=""></p>
<p>注意这里的 Token 仅用于计算签名，和请求企业微信接口时用于验证身份的 Token 不是同一个，因此随机获取就行。</p>
<p>URL 按以下格式填写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;IP:端口&#x2F;qiye-wechat&#x2F;agents&#x2F;应用的AgentId</span><br></pre></td></tr></table></figure>

<p>这里的 IP 和端口设置为个人服务器的 IP，以及即将在下一步启动服务时开放的端口。</p>
<p>Token 和 EncodingAESKey 随机获取或者自己填都行。</p>
<p>填完之后先不点保存，等到下一步【启动服务】执行完后再保存。因为保存的时候。企业微信会向上面的 URL 发送一个请求验证。</p>
<h2 id="4-启动服务"><a href="#4-启动服务" class="headerlink" title="4. 启动服务"></a>4. 启动服务</h2><p>登录个人服务器，下载下面这个项目：</p>
<p><a href="https://github.com/schaepher/noty" target="_blank" rel="noopener">https://github.com/schaepher/noty</a></p>
<p>进入项目文件夹，复制一份 config.json.example 到 config.json。初始内容为：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"addr"</span>: <span class="string">"127.0.0.1:55556"</span>,</span><br><span class="line">    <span class="attr">"corp_id"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"agents"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="number">1000002</span>,</span><br><span class="line">            <span class="attr">"secret"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"token"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"encoding_aes_key"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"echo"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>corp_id 是企业的 ID。通过以下链接页面底部获取：</p>
<p><a href="https://work.weixin.qq.com/wework_admin/frame#profile" target="_blank" rel="noopener">https://work.weixin.qq.com/wework_admin/frame#profile</a></p>
<p><img src="./corp-id.jpg" alt=""></p>
<p>在 agents 里面，填写刚刚创建的应用的信息。其中 secret 是通过应用界面的 Secret 一栏进入获取的。也就是下图的标记 2。</p>
<p><img src="./app-main-secret.jpg" alt=""></p>
<p>type 是 agent 类型，与企业微信无关，与本项目 qiyewechat 文件夹里 agent.go 的 AgentFactory 有关。默认为 echo，作用是个人微信发什么，服务器就返回什么。</p>
<p>接下来是编译和运行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go build</span><br><span class="line">./noty</span><br></pre></td></tr></table></figure>

<h2 id="5-配置企业微信"><a href="#5-配置企业微信" class="headerlink" title="5. 配置企业微信"></a>5. 配置企业微信</h2><p><img src="./api-rec-save.jpg" alt=""></p>
<p>回到刚才的【设置API接收】界面，点击保存。此时企业微信会发一条验证信息到服务器，如果通过，就能成功保存。</p>
<p>保存成功后，在这个页面下方的【企业可信IP】卡片里选择配置，将刚刚填入到 URL 的服务器 IP 添加进去。这样之后服务器才能主动调用企业微信的 API。</p>
<p><img src="./trusted-ip.jpg" alt=""></p>
<h2 id="6-个人微信收发消息"><a href="#6-个人微信收发消息" class="headerlink" title="6. 个人微信收发消息"></a>6. 个人微信收发消息</h2><p>在个人微信的【我的企业及企业联系人】分组中，找到企业。进入后可以看到应用，发送消息即可。</p>
<p><img src="./wechat-corp.jpg" alt=""></p>
<p>↓</p>
<p><img src="./wechat-corp-app.jpg" alt=""></p>
<p>↓</p>
<p><img src="./response.jpg" alt=""></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://schaepher.github.io/2022/06/14/mysql-mvcc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/theme/avatar.png">
      <meta itemprop="name" content="Schaepher">
      <meta itemprop="description" content="深透理解，熟练运用。<br>似懂非懂，其实不懂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schaepher's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/14/mysql-mvcc/" class="post-title-link" itemprop="url">MySQL InnoDB 并发控制之 MVCC</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-06-14 11:10:00" itemprop="dateCreated datePublished" datetime="2022-06-14T11:10:00+00:00">2022-06-14</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>MySQL 的多版本并发控制（Multiversion Concurrency Control，MVCC）解决了 InnoDB 事务隔离级别中读已提交和可重复读的读和写冲突问题。MVCC 使事务中执行普通的 SELECT 读取数据不需要对记录加锁，同时又能根据需要避免脏读、不可重复读、幻读的问题，提高了系统整体效率。</p>
<p>MVCC 要放在事务的框架中学习，因此下文会尽可能多地使用包含了“事务”的表述，用来增强读者脑中的“一个事务包含一条以上的 SQL”的印象。在此基础上要清楚如果没有显示地执行 <code>BEGIN</code> 开启事务或者 <code>set autocommit = 0</code> ，执行的单条 SQL 语句都会被 MySQL 作为一个事务执行。因此就可以通过事务的结构来统一地理解多条语句和单条语句的情况。</p>
<blockquote>
<p>注：下文提到数据库中的“行”的概念时，会使用“记录”这一表述代替。</p>
</blockquote>
<h2 id="疑问有哪些？"><a href="#疑问有哪些？" class="headerlink" title="疑问有哪些？"></a>疑问有哪些？</h2><p>在对 InnoDB 了解得很少时，会有以下的疑问：</p>
<ol>
<li>一条记录的多个版本是用什么区分的？是使用更新时间么？是使用版本号么？</li>
<li>一条记录应该保留多少个版本？</li>
<li>更新数据还未提交的时候，是不是有另外一块区域存放新数据，等到提交的时候才覆盖到数据页里原先的位置上？</li>
<li>在启动事务后，另一个事务更新了数据，那么旧数据会存放在哪？</li>
<li>是不是为每条记录都设置了独享的一块放置该数据的多个版本的内存或外存区域？</li>
<li>如果两个事务都想修改同一个数据，会怎么处理？</li>
</ol>
<h2 id="记录与事务"><a href="#记录与事务" class="headerlink" title="记录与事务"></a>记录与事务</h2><p>如果思考的视角是记录本身，就会往记录本身的更新时间和版本号去思考。但是正如前文强调的，无论是 MVCC 还是 SQL 语句对记录的修改都离不开事务。既然如此，就可以把视角转移到记录和事务的关系上。一旦明确这个关系，就可以考虑将事务的 ID 作为记录的版本号了。</p>
<p>在记录上引入事务 ID 字段表示最近一次变更该记录的事务。当一个事务更新该记录或标记删除的时候，将记录的版本号更新为这个事务的 ID。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">row_upd_rec_sys_fields</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">rec_t</span> *rec,                <span class="comment">/* 记录（record） */</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">page_zip_des_t</span> *page_zip,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> <span class="keyword">dict_index_t</span> *index, <span class="comment">/* 聚集索引 */</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> ulint *offsets,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">const</span> <span class="keyword">trx_t</span> *trx,          <span class="comment">/* 事务 */</span></span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">roll_ptr_t</span> roll_ptr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (page_zip) &#123;</span><br><span class="line">    <span class="comment">// ... 省略</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ulint offset = index-&gt;trx_id_offset;</span><br><span class="line">    <span class="comment">// ... 省略</span></span><br><span class="line">    trx_write_trx_id(rec + offset, trx-&gt;id);  <span class="comment">// &lt;-- 就是这里</span></span><br><span class="line">    <span class="comment">// ... 省略</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="未提交的更新存放在哪"><a href="#未提交的更新存放在哪" class="headerlink" title="未提交的更新存放在哪"></a>未提交的更新存放在哪</h2><p>通常情况下，如果数据没有提交，我们会认为它应该放在一个单独的地方。只有提交的时候，才把这些数据拿去覆盖原先的数据，否则其他事务在读取的时候，就会读取到未提交的数据。</p>
<p>MVCC 工作在读已提交和可重复读这两个事务级别上，说明使用 MVCC 的情况下不会出现读到未提交的数据。但是 MVCC 没有将未提交的数据单独存放，而是直接写入数据页，甚至会刷入磁盘。</p>
<blockquote>
<p>见回答及其评论区：<br><a href="https://www.zhihu.com/question/278643174/answer/522384191" target="_blank" rel="noopener">https://www.zhihu.com/question/278643174/answer/522384191</a><br>源码以后再找。</p>
</blockquote>
<h2 id="旧数据存放在哪"><a href="#旧数据存放在哪" class="headerlink" title="旧数据存放在哪"></a>旧数据存放在哪</h2><p>既然未提交的更新直接写入到数据页，那么原先的数据要怎么办？必然需要有一个地方存储旧数据的备份。</p>
<p>了解 InnoDB 的同学会知道 undo 日志的存在。undo 日志用于存储一个操作的反向操作，例如 insert 操作就是 delete；如果是 update，则产生一个更新回旧数据的 update。当事务回滚时执行 undo 日志中的操作达到恢复数据的效果。</p>
<h2 id="旧数据会存多少个版本"><a href="#旧数据会存多少个版本" class="headerlink" title="旧数据会存多少个版本"></a>旧数据会存多少个版本</h2><p>与这个问题相关的是：如果两个事务同时修改一个记录，会如何处理？</p>
<p>其中一个事务会在记录上加锁，在其释放锁之前，另一个事务无法加锁，也就无法操作数据。于是不会出现 undo 日志中存在多个事务未提交的记录。由于 undo 日志存储的是逻辑日志，一个事务有可能多次修改同一个数据，那么一个记录就可能出现多次出现在 undo 日志中。</p>
<p>undo 日志是以事务为粒度划分区域还是全局呢？</p>
<p>undo 日志按事务划分，各自组成一条链。</p>
<p>MySQL 在初始化的时候会创建两个回滚表空间（undo_001 和 undo_002 这两个文件），每个表空间划分了 TRX_SYS_N_RSEGS = 128 个段（Segement），这些在回滚表空间的段又称为回滚段（Rollback Segment，源码中简写为 rseg）。undo 日志存储于回滚段中。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">trx_t</span> &#123;</span></span><br><span class="line">    <span class="comment">// ... 省略</span></span><br><span class="line">    UndoMutex undo_mutex;</span><br><span class="line">    <span class="keyword">undo_no_t</span> undo_no;</span><br><span class="line">    <span class="keyword">space_id_t</span> undo_rseg_space;</span><br><span class="line">    <span class="keyword">trx_rsegs_t</span> rsegs; <span class="comment">/* 回滚段 */</span></span><br><span class="line">    <span class="comment">// ... 省略</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">trx_rsegs_t</span> &#123;</span></span><br><span class="line">  <span class="keyword">trx_undo_ptr_t</span> m_redo;   <span class="comment">/* 系统崩溃后需要恢复的回滚日志 */</span></span><br><span class="line">  <span class="keyword">trx_undo_ptr_t</span> m_noredo; <span class="comment">/* 系统崩溃后不需要恢复的回滚日志 */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">trx_undo_ptr_t</span> &#123;</span></span><br><span class="line">  <span class="keyword">trx_rseg_t</span> *rseg;        <span class="comment">/* 回滚段 */</span></span><br><span class="line">  <span class="keyword">trx_undo_t</span> *insert_undo; <span class="comment">/* 插入操作的 undo 日志指针*/</span></span><br><span class="line">  <span class="keyword">trx_undo_t</span> *update_undo; <span class="comment">/* 更新操作的 undo 日志指针*/</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 事务系统中心内存数据结构 */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">trx_sys_t</span> &#123;</span></span><br><span class="line">  <span class="comment">// ... 省略一些字段</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/** 多版本并发控制管理器 */</span></span><br><span class="line">  MVCC *mvcc;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** serialisation_list 的互斥量 */</span></span><br><span class="line">  TrxSysMutex serialisation_mutex;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 追踪未提交的最小事务号 */</span></span><br><span class="line">  UT_LIST_BASE_NODE_T(<span class="keyword">trx_t</span>, no_list) serialisation_list;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 为 MySQL 创建的事务列表 */</span></span><br><span class="line">  UT_LIST_BASE_NODE_T(<span class="keyword">trx_t</span>, mysql_trx_list) mysql_trx_list;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** 用于 MVCC 快照的一组读写事务 ID */</span></span><br><span class="line">  <span class="keyword">trx_ids_t</span> rw_trx_ids;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... 省略一些字段</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReadView</span> &#123;</span></span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">ids_t</span> &#123;</span></span><br><span class="line">    <span class="comment">// ... 省略</span></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">      <span class="comment">/** 大于等于此 ID 的事务修改的数据对该快照不可见 */</span></span><br><span class="line">      <span class="keyword">trx_id_t</span>    m_low_limit_id;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/** 小于此 ID 的事务对数据的修改对该快照可见 */</span></span><br><span class="line">      <span class="keyword">trx_id_t</span>    m_up_limit_id;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/** 创建该快照的事务 */</span></span><br><span class="line">      <span class="keyword">trx_id_t</span>    m_creator_trx_id;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/** 当该快照被创建时，处于活动中的所有读写事务 */</span></span><br><span class="line">      <span class="keyword">ids_t</span>       m_ids;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ... 省略</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... 省略</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">changes_visible</span><span class="params">(<span class="keyword">trx_id_t</span> id, <span class="keyword">const</span> <span class="keyword">table_name_t</span> &amp;name)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ... 省略</span></span><br><span class="line">    <span class="keyword">if</span> (id &lt; m_up_limit_id || id == m_creator_trx_id) &#123;</span><br><span class="line">      <span class="keyword">return</span> (<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    check_trx_id_sanity(id, name);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (id &gt;= m_low_limit_id) &#123;</span><br><span class="line">      <span class="keyword">return</span> (<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (m_ids.empty()) &#123;</span><br><span class="line">      <span class="keyword">return</span> (<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">ids_t</span>::value_type *p = m_ids.data();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (!<span class="built_in">std</span>::binary_search(p, p + m_ids.<span class="built_in">size</span>(), id));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReadView::prepare</span><span class="params">(<span class="keyword">trx_id_t</span> id)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ... 省略</span></span><br><span class="line"></span><br><span class="line">  m_creator_trx_id = id;</span><br><span class="line"></span><br><span class="line">  m_low_limit_no = trx_get_serialisation_min_trx_no();</span><br><span class="line"></span><br><span class="line">  m_low_limit_id = trx_sys_get_next_trx_id_or_no();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!trx_sys-&gt;rw_trx_ids.empty()) &#123;</span><br><span class="line">    copy_trx_ids(trx_sys-&gt;rw_trx_ids);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    m_ids.<span class="built_in">clear</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  m_up_limit_id = !m_ids.empty() ? m_ids.front() : m_low_limit_id;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... 省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://schaepher.github.io/2022/06/11/red-black-tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/theme/avatar.png">
      <meta itemprop="name" content="Schaepher">
      <meta itemprop="description" content="深透理解，熟练运用。<br>似懂非懂，其实不懂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schaepher's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/11/red-black-tree/" class="post-title-link" itemprop="url">红黑树</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-06-11 12:26:00" itemprop="dateCreated datePublished" datetime="2022-06-11T12:26:00+00:00">2022-06-11</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>2-3 树和 2-3-4 树统称为 B-树（Balanced Tree）。</p>
<h3 id="为什么不直接使用-B-树？"><a href="#为什么不直接使用-B-树？" class="headerlink" title="为什么不直接使用 B-树？"></a>为什么不直接使用 B-树？</h3><p>既然以 2-3 树和 2-3-4 树都可以用来转换成红黑树，为什么最终使用 2-3-4 树的转换呢？</p>
<blockquote>
<p><a href="https://stackoverflow.com/questions/8765558/why-dont-we-use-2-3-or-2-3-4-5-trees" target="_blank" rel="noopener">https://stackoverflow.com/questions/8765558/why-dont-we-use-2-3-or-2-3-4-5-trees</a></p>
</blockquote>
<blockquote>
<p>Implementation of 2-3-4 trees typically requires either multiple classes (2NODE, 3NODE, 4NODE) or you have just NODE that has an array of items. In the case of multiple classes you waste lots of time constructing and destructing node instances and reparenting them is cumbersome. If you use a single class with arrays to hold items and children then you are either resizing arrays constantly which is similarly wasteful or you wind up wasting over half your memory on unused array elements. It’s just not very efficient compared to Red-Black trees.</p>
</blockquote>
<blockquote>
<p>Red-Black trees have only one type of node structure. Since Red-Black trees have a duality with 2-3-4 trees, RB trees can use the exact same algorithms as 2-3-4 trees (no need for the stupidly confusing/complex implementations described in Cormen, Leiserson and Rivest that led to AA trees which are not less complex than the 2-3-4 algorithm.)</p>
</blockquote>
<blockquote>
<p>So, Red-Black trees for their ease of implementation plus their memory/CPU efficiency. (AVL trees are nice too. They produce more well balanced trees and are stupid simply to code but they tend to be less efficient due to working too often to maintain only a slightly more compact tree.)</p>
</blockquote>
<blockquote>
<p>Oh, and 2-3-4-5-6… etc aren’t done because nothing is gained. 2-3-4 has a net-gain over 2-3 trees because they can be done without recursion easily (recursion tends to be less efficient, especially when it cannot be coded tail-recursively). However, B-Trees and Bplus-Trees are pretty much 2-3-4-5-6-7-8-9-etc trees where the max size of the nodes, n, is chosen so that n records can be stored in a single disk sector. (i.e. each disk sector is a node in the tree and the size of the sector is equivalent to the number of items stored in the node.) This is because the time to search through 512 records linearly in memory is still MUCH faster than traversing down a level in the tree which requires another disk seek/fetch. and O(512) is still O(1) and thus maintains O(lg n) for the tree.</p>
</blockquote>
<blockquote>
<p><a href="https://read.seas.harvard.edu/~kohler/notes/llrb.html" target="_blank" rel="noopener">https://read.seas.harvard.edu/~kohler/notes/llrb.html</a></p>
</blockquote>
<p>下一篇将会详细展开红黑树的内容。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://schaepher.github.io/2022/06/02/2-3-tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/theme/avatar.png">
      <meta itemprop="name" content="Schaepher">
      <meta itemprop="description" content="深透理解，熟练运用。<br>似懂非懂，其实不懂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schaepher's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/02/2-3-tree/" class="post-title-link" itemprop="url">2-3树 —— 理解红黑树的捷径</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-06-02 12:26:00" itemprop="dateCreated datePublished" datetime="2022-06-02T12:26:00+00:00">2022-06-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>如果从先易后难的顺序介绍各种树，那么红黑树必然放在 AVL 树后面。但在红黑树之前，还有一种名为 2-3 树的平衡二叉树。2-3 树理解起来比红黑树容易很多，并且在理解它的基础上增加一个变更，就成了红黑树（尽管不是通常使用的那种红黑树）。因此学习红黑树的时候，最好先学习 2-3 树。</p>
<p>2-3 树与 AVL 树有一个不同的地方：AVL 树是从上到下增加树高，根节点只会因为旋转而改变；而 2-3 树是从下到上增加树高，节点值是从下往上挤，原先根节点容纳不下的时候，挤出一个新的根节点。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/06/02/2-3-tree/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://schaepher.github.io/2022/06/01/print-binary-tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/theme/avatar.png">
      <meta itemprop="name" content="Schaepher">
      <meta itemprop="description" content="深透理解，熟练运用。<br>似懂非懂，其实不懂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schaepher's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/06/01/print-binary-tree/" class="post-title-link" itemprop="url">打印二叉树</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-06-01 18:50:00" itemprop="dateCreated datePublished" datetime="2022-06-01T18:50:00+00:00">2022-06-01</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>之前在了解二叉树旋转的时候，为了方便查看中间状态，就写了个以树状形式打印二叉树的函数。</p>
<p>起初是使用二叉树中序遍历的结果展开的方式，简单但打印出来的树有一定的倾斜。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/06/01/print-binary-tree/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://schaepher.github.io/2022/05/30/balanced-binary-tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/theme/avatar.png">
      <meta itemprop="name" content="Schaepher">
      <meta itemprop="description" content="深透理解，熟练运用。<br>似懂非懂，其实不懂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schaepher's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/30/balanced-binary-tree/" class="post-title-link" itemprop="url">平衡二叉树</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-30 15:15:00" itemprop="dateCreated datePublished" datetime="2022-05-30T15:15:00+00:00">2022-05-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-06-01 18:40:00" itemprop="dateModified" datetime="2022-06-01T18:40:00+00:00">2022-06-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>上一篇把树旋转了解清楚，是为这一篇平衡二叉树准备的。</p>
<p>平衡二叉树，就是在二叉树的基础上加上一个条件：对于任意节点，左子树和右子树的树高之差不超过 1。</p>
<p>从实现的角度看，就是在已具备旋转功能的 Node 上增加一个 height 字段，并且在原先的代码上增加对 height 的操作。关键操作是判断左右子树的树高之差，根据树高之差选择需要执行的旋转。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/05/30/balanced-binary-tree/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://schaepher.github.io/2022/05/24/life-view/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/theme/avatar.png">
      <meta itemprop="name" content="Schaepher">
      <meta itemprop="description" content="深透理解，熟练运用。<br>似懂非懂，其实不懂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schaepher's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/24/life-view/" class="post-title-link" itemprop="url">选择人生(草稿)</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-24 22:25:00" itemprop="dateCreated datePublished" datetime="2022-05-24T22:25:00+00:00">2022-05-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>我偶尔会思考“我的一生应该是什么样的”这个问题。当我偶然间思考出了一个足够明确的答案后，就自然而然地以最佳的状态去面对生活。</p>
<p>只是我没有及时地将这些内容记录下来，以至于因为一些事情而逐渐地忘记一部分内容，这种状态就消失了。如果能让那种时刻保持充分幸福感的状态一直持续下去，我也就心满意足了。所以我尝试现在将剩下的部分写出来，一是试图通过这种方式将遗忘的部分重新推导出来，二是为了以后重新进入状态的时候能快速补足内容。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/05/24/life-view/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://schaepher.github.io/2022/05/11/tree-rotation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/theme/avatar.png">
      <meta itemprop="name" content="Schaepher">
      <meta itemprop="description" content="深透理解，熟练运用。<br>似懂非懂，其实不懂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schaepher's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/11/tree-rotation/" class="post-title-link" itemprop="url">因为一句话，秒懂二叉树旋转</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-11 12:30:00" itemprop="dateCreated datePublished" datetime="2022-05-11T12:30:00+00:00">2022-05-11</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>事情要从某天晚上买夜宵说起。买了香肠拿着吃，想着多年来一直没搞懂的树旋转是不是应该看看，就点进某百科。</p>
<blockquote>
<p>树旋转是在二叉树中的一种子树调整操作， 每一次旋转并不影响对该二叉树进行中序遍历的结果。</p>
</blockquote>
<p>中序遍历！灵光一闪，好像很多东西都联系起来了！</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/05/11/tree-rotation/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://schaepher.github.io/2022/05/10/cert-verify/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/theme/avatar.png">
      <meta itemprop="name" content="Schaepher">
      <meta itemprop="description" content="深透理解，熟练运用。<br>似懂非懂，其实不懂。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Schaepher's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/10/cert-verify/" class="post-title-link" itemprop="url">手动验证 TLS 证书</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-10 12:30:00" itemprop="dateCreated datePublished" datetime="2022-05-10T12:30:00+00:00">2022-05-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="证书验证"><a href="#证书验证" class="headerlink" title="证书验证"></a>证书验证</h2><h3 id="证书结构"><a href="#证书结构" class="headerlink" title="证书结构"></a>证书结构</h3><p>我们现在使用的 TLS 证书的标准是 X.509，版本号为 V3。版本号可从证书的 Version 字段看到。</p>
<p>根据 <a href="https://datatracker.ietf.org/doc/html/rfc3280.html?msclkid=a0a5d923cf8211ec99debd4d1b18e2b5#section-4.1" target="_blank" rel="noopener">RFC 3280</a> 定义的证书结构，证书由三个部分组成：</p>
<ol>
<li>证书主体（TBSCertificate，To Be Signed Certificate，待签名证书）  </li>
<li>签名算法</li>
<li>签名值</li>
</ol>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2022/05/10/cert-verify/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Schaepher"
      src="/images/theme/avatar.png">
  <p class="site-author-name" itemprop="name">Schaepher</p>
  <div class="site-description" itemprop="description">深透理解，熟练运用。<br>似懂非懂，其实不懂。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">120</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">128</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"><a rel="license noopener" href="http://creativecommons.org/licenses/by/2.5/cn/" target="_blank"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by/2.5/cn/88x31.png" /></a><br />本文采用<a rel="license noopener" href="http://creativecommons.org/licenses/by/2.5/cn/" target="_blank">知识共享署名 2.5 中国大陆许可协议</a>进行许可。欢迎转载，演绎或用于商业目的，但是必须保留本文的署名 <a href="https://www.cnblogs.com/schaepher" target="_blank" rel="noopener">schaepher</a>（包含链接）。如您有任何疑问或者授权方面的协商，请<a target="_blank" href="https://msg.cnblogs.com/send/schaepher">给我留言</a>。</p></span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.2
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://schaepher.github.io/',]
      });
      });
  </script>


</body>
</html>
